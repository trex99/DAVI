# -*- coding: utf-8 -*-
"""[ë¬¸ì œ]ì¤‘ê°„ê³ ì‚¬_ë¯¸ì™„ì„±_ë¬¸ì œí•´ê²°_í”„ë¡œê·¸ë¨_1.ipynb

Automatically generated by Colaboratory.

Original file is located at
    https://colab.research.google.com/drive/1SuuC7V0Bh2tWTURj01-VqxQl7JjOheYH

# ğŸ‘ ì¤‘ê°„ê³ ì‚¬ - ë¯¸ì™„ì„± ë¬¸ì œí•´ê²° í”„ë¡œê·¸ë¨

## [ì‹œí—˜ë¬¸ì œ]
- ì£¼ì„ì˜ ì•ˆë‚´ì— ë”°ë¼ ë¯¸ì™„ì„± í”„ë¡œê·¸ë¨ì„ ì™„ì„±í•˜ê³ , ì¤‘ê°„ê³ ì‚¬ ì‹œí—˜ë¬¸ì œ 11ë²ˆ ~ 15ë²ˆê¹Œì§€ì˜ ì§ˆë¬¸ì— ë‹µí•˜ì„¸ìš”.

## [ë¬¸ì œìƒí™© - í•´ê²°í•  ë¬¸ì œ ì •ì˜]

- ê²½ìƒë‚¨ë„ ê¹€í•´ì‹œëŠ” ì¹œí™˜ê²½ ë„ì‹œë¥¼ ìŠ¬ë¡œê±´ìœ¼ë¡œ ì „ê¸° ìì „ê±° ìŠ¤í…Œì´ì…˜ì„ ì„¤ì¹˜í•˜ì˜€ë‹¤.
- ê¸ˆë…„ì— ê¹€í•´ì‹œ ì‚¬ì—…ê³„íšì— ë”°ë¼ ì „ê¸° ìì „ê±° í™œì„±í™”ë¥¼ ìœ„í•˜ì—¬ ìœ„ì¹˜ì •ë³´ ì¡°íšŒ ì„œë¹„ìŠ¤ë¥¼ í™ˆí˜ì´ì§€ì— ê²Œì‹œí•˜ê¸°ë¡œ í•˜ì˜€ë‹¤.
- ìì „ê±° ë³´ê´€ì†Œ ë°ì´í„° ì¡°íšŒ í›„ ì§€ë„ì— ìœ„ì¹˜ë¥¼ í‘œì‹œí•˜ëŠ” í•µì‹¬ ì„œë¹„ìŠ¤ í”„ë¡œê·¸ë¨ì„ ì™„ì„±í•˜ì„¸ìš”.

- ê³µê³µë°ì´í„° í¬í„¸ : https://www.data.go.kr/

- ê³µê³µë°ì´í„°í¬í„¸ì˜ ë°ì´í„°ëª… : ê²½ìƒë‚¨ë„ ê¹€í•´ì‹œ_ì „ê¸°ìì „ê±° ìŠ¤í…Œì´ì…˜ ìœ„ì¹˜ì •ë³´

### Open API ì´ìš© ë°ì´í„° ìˆ˜ì§‘
"""

# Open API í†µì‹  ì‹¤íŒ¨ë¡œ ë°ì´í„°ë¥¼ ë°›ì•„ì˜¤ì§€ ëª»í•˜ëŠ” ê²½ìš° ëŒ€ì‹ í•  ë°ì´í„°
open_api_data = '''
{"status":"999","message":"ì •ìƒ ì²˜ë¦¬ ë˜ì—ˆìŠµë‹ˆë‹¤.","data":[{"mgtNo":"STATION_001","name":"ë´‰í™©ì—­","xCoordinate":"128.8736411","yCoordinate":"35.2277057","addr":"ê²½ìƒë‚¨ë„ ê¹€í•´ì‹œ ì™¸ë™ 1264"},{"mgtNo":"STATION_002","name":"ìˆ˜ë¡œì™•ë¦‰ì—­","xCoordinate":"128.872086162507","yCoordinate":"35.2329938518363","addr":"ê¹€í•´ì‹œ ì™¸ë™ 1297"},{"mgtNo":"STATION_003","name":"ìˆ˜ë¡œì™•ë¦‰","xCoordinate":"128.8789361","yCoordinate":"35.2334009","addr":"ê¹€í•´ì‹œ ì„œìƒë™ 335-1"},{"mgtNo":"STATION_004","name":"ëŒ€ì„±ë™ê³ ë¶„ë°•ë¬¼ê´€","xCoordinate":"128.8728810","yCoordinate":"35.2348520","addr":"ê¹€í•´ì‹œ ë´‰í™©ë™ 453-1"},{"mgtNo":"STATION_005","name":"ë°•ë¬¼ê´€ì—­","xCoordinate":"128.8718979","yCoordinate":"35.2400377","addr":"ê¹€í•´ì‹œ ë‚´ë™ 1147"},{"mgtNo":"STATION_006","name":"ìˆ˜ë¡œì™•ë¹„ë¦‰","xCoordinate":"128.877676954359","yCoordinate":"35.2425291957211","addr":"ê¹€í•´ì‹œ êµ¬ì‚°ë™ 93-1"},{"mgtNo":"STATION_007","name":"êµ­ë¦½ê¹€í•´ë°•ë¬¼ê´€","xCoordinate":"128.872223171877","yCoordinate":"35.2437152642491","addr":"ê¹€í•´ì‹œ êµ¬ì‚°ë™ 1032"},{"mgtNo":"STATION_008","name":"ì—°ì§€ê³µì›ì—­","xCoordinate":"128.8696941","yCoordinate":"35.2493142","addr":"ê¹€í•´ì‹œ êµ¬ì‚°ë™ 1072-16"},{"mgtNo":"STATION_009","name":"ì—°ì§€ê³µì›","xCoordinate":"128.8697906","yCoordinate":"35.2447422","addr":"ê¹€í•´ì‹œ ë‚´ë™ 1068"},{"mgtNo":"STATION_010","name":"ê±°ë¶ê³µì›","xCoordinate":"128.8656057","yCoordinate":"35.2370078","addr":"ê¹€í•´ì‹œ ë‚´ë™ 1116-2"},{"mgtNo":"STATION_011","name":"ê³µì£¼ê³µì›","xCoordinate":"128.8684638","yCoordinate":"35.2345124","addr":"ê¹€í•´ì‹œ ë‚´ë™ 1146-7"}]}
'''

# ê³µê³µë°ì´í„°í¬í„¸ì˜ Open APIë¥¼ ì´ìš©í•œ ë°ì´í„° ìˆ˜ì§‘
import ?  # ë¬¸ì œ 1-1 : ì•„ë˜ ì½”ë“œë¥¼ ìˆ˜ì •í•˜ì§€ ì•Šê³  ì •ìƒ êµ¬ë™ ë˜ë„ë¡ "?" ì— ì•Œë§ëŠ” íŒ¨í‚¤ì§€ëª…ì„ ì‘ì„±í•˜ì„¸ìš”.

url = 'https://smartcity.gimhae.go.kr/smart_tour/dashboard/api/publicData/location/bicycleStation'

# Open API í†µì‹  ì‹¤íŒ¨ì‹œ ì²˜ë¦¬ë¥¼ ìœ„í•œ try ~ exept ë¸”ë¡ ì²˜ë¦¬
try:
    response = requests.get(url, verify=False, stream=True, timeout=5)
    data = response.content.decode('utf-8')  # ë°ì´í„°ë¥¼ ë°›ì•˜ìœ¼ë©´ ë¬¸ìì…‹ì„ utf-8ë¡œ ë³€í˜•
except:
    data = open_api_data # í†µì‹ ì— ì‹¤íŒ¨í–ˆë‹¤ë©´ ì´ë¯¸ ì¤€ë¹„í•œ ë°ì´í„°ë¥¼ ì´ìš©í•˜ë„ë¡ ì²˜ë¦¬

# ë°ì´í„° ìˆ˜ì§‘ê²°ê³¼ ì¶œë ¥
print(type(data), data)

# ìˆ˜ì§‘ê²°ê³¼ ë°ì´í„° ì²˜ë¦¬ : stringìë£Œí˜•ìœ¼ë¡œ dictìë£Œí˜•ìœ¼ë¡œ ë³€í™˜
import json

after_data = json.?(data) # ë¬¸ì œ 1-2 : string ìë£Œí˜•ì¸ data ê°’ì„ dict ìë£Œí˜•ìœ¼ë¡œ ë³€í™˜í•˜ëŠ” ì½”ë“œë¥¼ ì‘ì„±í•˜ì„¸ìš”.
after_data

# dict ìë£Œí˜•ìœ¼ë¡œ ë³€í™˜ë˜ì—ˆëŠ”ì§€ í™•ì¸
type(after_data)

# í•„ìˆ˜ ë°ì´í„°ì¸ ê° ì§€ì—­ë³„ ì •ë³´ë§Œ ì¶”ì¶œ
x_data = after_data['data']
x_data

# ê° ì§€ì—­ì •ë³´ë¥¼ pandas ë°ì´í„°í”„ë ˆì„ìœ¼ë¡œ ë³€í™˜
import pandas as pd

real_data = pd.?(x_data) # ë¬¸ì œ 1-3 : dict ìë£Œí˜•ì¸ x_data ê°’ì„ pandas ë°ì´í„°í”„ë ˆì„ ê°ì²´ë¡œ ë³€í™˜í•˜ëŠ” ì½”ë“œë¥¼ ì‘ì„±í•˜ì„¸ìš”.
real_data

"""- ê° ì»¬ëŸ¼ì´ ì˜ë¯¸í•˜ëŠ” ë‚´ìš©
    - mgtNo : ìŠ¤í…Œì´ì…˜ ê´€ë¦¬ ë²ˆí˜¸
    - name : ìŠ¤í…Œì´ì…˜ ì´ë¦„
    - xCoordinate : ê²½ë„ (ì™¼ìª½ ë˜ëŠ” ì˜¤ë¥¸ìª½ì—ì„œ ë–¨ì–´ì§„ ê±°ë¦¬)
    - yCoordinate : ìœ„ë„ (ë‚¨ìª½ ë˜ëŠ” ë¶ìª½ì—ì„œ ë–¨ì–´ì§„ ê±°ë¦¬)
    - addr : ì£¼ì†Œ
"""

# ê° ì»¬ëŸ¼ì˜ ì»¬ëŸ¼ëª…, ìë£Œí˜•, ê²°ì¸¡ì¹˜, ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰ ë“± í™•ì¸
real_data.info()

# xCoordinate, yCoordinate ìë£Œí˜• ë³€ê²½
# ë¬¸ì œ 1-4 : real_data ë°ì´í„°í”„ë ˆì„ì˜ xCoordinate, yCoordinate ì»¬ëŸ¼ì˜ ìë£Œí˜•ì„ floatë¡œ ë³€í™˜í•˜ëŠ” ì½”ë“œë¥¼ ì‘ì„±í•˜ì„¸ìš”.
real_data['xCoordinate'] = real_data['xCoordinate'].?('float')
real_data['yCoordinate'] = real_data['yCoordinate'].?('float')

# ê° ì»¬ëŸ¼ì˜ ì»¬ëŸ¼ëª…, ìë£Œí˜•, ê²°ì¸¡ì¹˜, ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰ ë“± í™•ì¸
real_data.info()

# ë¶ˆí•„ìš”í•œ ì»¬ëŸ¼ìœ¼ë¡œ ìƒê°ë˜ëŠ” mgtNo ì»¬ëŸ¼ì„ ì œê±°
real_data = real_data.drop(?) # ë¬¸ì œ 1-5 : real_data ë°ì´í„°í”„ë ˆì„ì˜ mgtNo ì»¬ëŸ¼ì„ ì œê±°í•˜ëŠ” ì½”ë“œë¥¼ ì™„ì„±í•˜ì„¸ìš”.
real_data.head()

# ê° ì»¬ëŸ¼ë³„ ê²°ì¸¡ì¹˜ ê°¯ìˆ˜ í™•ì¸
real_data.isnull().sum()

# ìˆ˜ì¹˜í˜• ë°ì´í„°ì— ëŒ€í•œ ê°¯ìˆ˜, í‰ê· , í‘œì¤€í¸ì°¨, ìµœì†Œ, ìµœëŒ€, ì‚¬ë¶„ìœ„ ê°’ë“± ê¸°ì´ˆí†µê³„ëŸ‰ í™•ì¸
# ë¬¸ì œ 1-6 : real_data ë°ì´í„°í”„ë ˆì„ì˜ xCoordinate ì˜ í‰ê· ì€ ì–¼ë§ˆì¸ê°€ìš” ?
real_data.describe()

# folium íŒ¨í‚¤ì§€ë¥¼ ì´ìš©í•˜ì—¬ "ë´‰í™©ì—­" ìŠ¤í…Œì´ì…˜ì˜ ìœ„ë„, ê²½ë„ë¥¼ ì§€ë„ì— ë§ˆì»¤ë¡œ í‘œì‹œ
import ? # ë¬¸ì œ 1-7 : ì•„ë˜ ì½”ë“œë¥¼ ìˆ˜ì •í•˜ì§€ ì•Šê³  ì •ìƒ êµ¬ë™ ë˜ë„ë¡ "?" ì— ì•Œë§ëŠ” íŒ¨í‚¤ì§€ëª…ì„ ì‘ì„±í•˜ì„¸ìš”.

map_figure = folium.Figure(width=700, height=350) # map í¬ê¸° ë³€ê²½
map_ = folium.Map(location=[35.2277057, 128.8736411], zoom_start=17).add_to(map_figure) # ë´‰í™©ì—­ ìŠ¤í…Œì´ì…˜ ìœ„ë„, ê²½ë„ë¥¼ ì¤‘ì‹¬ìœ¼ë¡œ ì§€ë„ êµ¬ì„±

popup = folium.Popup('ë´‰í™©ì—­', min_width=200, max_width=200) # ë´‰í™©ì—­ ë§ˆì»¤ í´ë¦­ì‹œ ì¶œë ¥í•  íŒì—… ë©”ì„¸ì§€ ì¤€ë¹„
folium.Marker([35.2277057, 128.8736411], popup=popup, tooltip='ê²½ìƒë‚¨ë„ ê¹€í•´ì‹œ ì™¸ë™ 1264').add_to(map_) # ë´‰í™©ì—­ ë§ˆì»¤ ì¶œë ¥
map_  # map ì¶œë ¥

# folium íŒ¨í‚¤ì§€ë¥¼ ì´ìš©í•˜ì—¬ ëª¨ë“  ìŠ¤í…Œì´ì…˜ì„ ì§€ë„ì— ë§ˆì»¤ë¡œ ì¶œë ¥
import folium

map_figure = folium.Figure(width=700, height=350) # map í¬ê¸° ë³€ê²½
map_ = folium.Map(location=[35.2277057, 128.8736411], zoom_start=14).add_to(map_figure) # ë´‰í™©ì—­ ìŠ¤í…Œì´ì…˜ ìœ„ë„, ê²½ë„ë¥¼ ì¤‘ì‹¬ìœ¼ë¡œ ì§€ë„ êµ¬ì„±

# ë¬¸ì œ 1-8 : real_data ë°ì´í„°í”„ë ˆì„ ê°ê°ì˜ Row ê°’ì„ ì½ê¸° ìœ„í•˜ì—¬ iterrows() í•¨ìˆ˜ë¥¼ ì‚¬ìš©í•˜ëŠ” ì½”ë“œë¥¼ ì™„ì„±í•˜ì„¸ìš”.
for row_index, ? in real_data.iterrows():
    popup = folium.Popup(row['name'], min_width=200, max_width=200) # ë§ˆì»¤ í´ë¦­ì‹œ ì¶œë ¥í•  íŒì—… ë©”ì„¸ì§€ ì¤€ë¹„
    folium.Marker([row.yCoordinate, row.xCoordinate], popup=popup, tooltip=row.addr).add_to(map_) # ë§ˆì»¤ ì¶œë ¥
map_  # map ì¶œë ¥

# folium íŒ¨í‚¤ì§€ë¥¼ ì´ìš©í•˜ì—¬ ëª¨ë“  ìŠ¤í…Œì´ì…˜ì„ ì§€ë„ì— ë§ˆì»¤ë¡œ ì¶œë ¥
# ë‹¨, ëª¨ë“  ì¢Œí‘œë¥¼ ëŒ€ìƒì„ ì¤‘ì‹¬ ì¢Œí‘œë¥¼ êµ¬í•˜ì—¬ ëª¨ë“  ë§ˆì»¤ê°€ ë³´ì´ë„ë¡ ì²˜ë¦¬
import folium

# ì¤‘ì‹¬ ì¢Œí‘œë¥¼ ê° ì¢Œí‘œì˜ í‰ê· ìœ¼ë¡œ í•œë‹¤.

# ë¬¸ì œ 1-9 : xCoordinate í‰ê·  ê°’ì„ ì¤‘ì‹¬ ì¢Œí‘œë¡œ ì‚¬ìš©í•˜ë ¤ê³  í•©ë‹ˆë‹¤. ì•Œë§ì€ í•¨ìˆ˜ë¥¼ ì™„ì„±í•˜ì„¸ìš”.
x_center = real_data.xCoordinate.astype(float).?()
# ë¬¸ì œ 1-10 : yCoordinate í‰ê·  ê°’ì„ ì¤‘ì‹¬ ì¢Œí‘œë¡œ ì‚¬ìš©í•˜ë ¤ê³  í•©ë‹ˆë‹¤. ì•Œë§ì€ í•¨ìˆ˜ë¥¼ ì™„ì„±í•˜ì„¸ìš”.
y_center = real_data.yCoordinate.astype(float).?()

map_figure = folium.Figure(width=700, height=350) # map í¬ê¸° ë³€ê²½
map_ = folium.Map(location=[y_center, x_center], zoom_start=13).add_to(map_figure) # ëª¨ë“  ì¢Œí‘œì˜ ì¤‘ì‹¬ì¢Œí‘œ(í‰ê· ì¢Œí‘œ)ì˜ ìœ„ë„, ê²½ë„ë¥¼ ì¤‘ì‹¬ìœ¼ë¡œ ì§€ë„ êµ¬ì„±

for row_index, row in real_data.iterrows():
    popup = folium.Popup(row['name'], min_width=200, max_width=200) # ë§ˆì»¤ í´ë¦­ì‹œ ì¶œë ¥í•  íŒì—… ë©”ì„¸ì§€ ì¤€ë¹„
    folium.Marker([row.yCoordinate, row.xCoordinate], popup=popup, tooltip=row.addr).add_to(map_) # ë§ˆì»¤ ì¶œë ¥
map_  # map ì¶œë ¥

"""- End Of Program"""